window.templateType="pic";function resetPageContent(){if(T.g("wrapper")){T.g("wrapper").style.display="none"}if(T.g("imgInfoCont")){T.g("imgInfoCont").style.display="none"}if(T.g("imgInfoComment")){T.g("imgInfoComment").style.display="none"}}function fillData(c,b){var b=b||{},a=b.type||{};fillData.DONE=false;setBodyHeight();if(!c){return}if(c.image&&c.image.length){moreInfo(c)}fillData.DONE=true;callAppFun("relayout")}moreInfo.userComentFlag=0;function moreInfo(m){var z=m.image,k=m.src_name,e=65,v=document.body.clientWidth;window.picConHeight=window.deviceHeight-e-20;if(!z){return}for(var q=0;q<z.length;q++){if(window.poiInfo.imgUrl&&(z[q].imgUrl==window.poiInfo.imgUrl)){window.poiInfo.index=q;break}else{if((q==z.length-1)&&window.poiInfo.name&&window.poiInfo.imgUrl&&window.poiInfo.cn_name){window.poiInfo.index=q+1;z[q+1]={name:window.poiInfo.name,imgUrl:window.poiInfo.imgUrl,cn_name:window.poiInfo.cn_name};break}}}var c=[],h=0,y=window.poiInfo.index||0,y=y>(z.length-1)?z.length-1:y*1;for(var q=0;q<z.length;q++){var f=z[q],A="",r="",n="src",x="width="+(window.deviceWidth-20)+"&",j="height="+picConHeight+"&",l="",b="quality=80",g="http://map.baidu.com/maps/services/thumbnails?src="+encodeURIComponent(f.imgUrl)+"&"+x+j+l+b,w=f.nickName||"",p=f.score||"",d=f.content||"",u=f.price||"",s=f.third_name||"";if(f.name=="fantong"){g=f.imgUrl}if(q<(y-1)||q>(y+1)){n="_src"}if(f.imgUrl&&f.cn_name){c.push('<li style="width:'+v+"px;height:"+window.picConHeight+'px">'+A+'<img id="img_id_'+h+'" '+n+'="'+g+'" title="'+f.cn_name+'" from="'+f.name+'" s_name="'+(f.s_name||"")+'" width="300px" height="480px" onload="javascript:scaleImage(this);if(this.parentNode){this.parentNode.style.backgroundImage=\'none\'}" onerror="if(this.src && this.parentNode){T.addClass(this.parentNode,\'error\')}" style="display:none;" _user_n="'+w+'" _user_s="'+p+'" _user_c="'+d+'" _user_p="'+u+'" _user_r="'+s+'" />'+r+"</li>");h++}}moreInfo.img_num=h;T.g("scroller").style.width=(v*h)+"px";T.g("wrapper").style.display="";T.g("thelist").innerHTML=c.join("");var t=T.g("pic_from_cont"),o=T.g("imgInfoNumCon");var a=function(F){var N=T.g("img_id_"+F),J=N.getAttribute("from"),i=N.getAttribute("s_name")||"",i=i==""?"":"_"+i,E="http://map.baidu.com/fwmap/upload/place/icon/"+J+"/50"+i+".png",M=N.getAttribute("_user_n")||"",G=N.getAttribute("_user_s")||"",D=N.getAttribute("_user_c")||"",I=N.getAttribute("_user_p")||"",H=N.getAttribute("_user_r")||"",B=60,L=D.slice(0,B-2)+"...",C=4-(parseInt(G)+1)/2,K=["推荐","一般","不推荐"];G=K[C-1];t.style.backgroundImage="url("+E+")";t.innerHTML=N.title;o.style.display="none";o.innerHTML=(F+1)+"/"+h;T.g("pic_user_name").innerHTML=M;T.g("pic_user_mark").innerHTML=G;T.g("pic_user_mark").style.background='url("../img/'+C+'-1.png") no-repeat left center';T.g("pic_user_mark").style.backgroundSize="20px 20px";if(J=="shenbian"&&M&&G&&D&&I&&H){moreInfo.userComentFlag=0;if(D.length>B){T.g("pic_user_comment_short").innerHTML=L;T.g("pic_user_comment_short").style.display="";T.g("pic_user_comment").style.display="none";T.g("pic_user_comment").innerHTML=D;moreInfo.userComentFlag=1}else{T.g("pic_user_comment").innerHTML=D;moreInfo.userComentFlag=0}T.g("pic_user_price").innerHTML="人均:"+I;T.g("pic_user_category").innerHTML=H;if(moreInfo.userComentFlag==1){T.g("pic_change_control_icon_short").style.background='url("../img/down_1.png") no-repeat';T.g("pic_change_control_icon_short").style.backgroundSize="20px 20px";T.g("pic_change_control_icon_short").setAttribute("onclick","changeLog()");T.g("pic_change_control_icon").style.background='url("../img/up_1.png") no-repeat';T.g("pic_change_control_icon").style.backgroundSize="20px 20px";T.g("pic_change_control_icon").setAttribute("onclick","changeLog()");T.g("pic_user_comment").setAttribute("onclick","changeLog();");T.g("pic_user_comment_short").setAttribute("onclick","changeLog();")}else{T.g("pic_change_control_icon").style.display="none"}T.g("imgInfoComment").style.display="";T.g("imgInfoCont").style.display="none"}else{T.g("imgInfoComment").style.display="none";T.g("imgInfoCont").style.display=""}};a(y);window.myScroll=new iScroll("wrapper",{x:-(y*v),currPageX:y,snap:true,momentum:false,hScrollbar:false,onScrollEnd:function(E){var C=this.currPageX*1;a(C);for(var D=-1;D<2;D++){var B=T.g("img_id_"+(C+D));if(B&&B.getAttribute("_src")){B.src=B.getAttribute("_src")}}}})}var changeLog=function(){if(moreInfo.userComentFlag==1){T.g("pic_user_comment_short").style.display="none";T.g("pic_user_comment").style.display="";T.g("pic_change_control_icon_short").style.display="none";T.g("pic_change_control_icon").style.display="";moreInfo.userComentFlag=2}else{if(moreInfo.userComentFlag==2){T.g("pic_user_comment_short").style.display="";T.g("pic_user_comment").style.display="none";T.g("pic_change_control_icon_short").style.display="";T.g("pic_change_control_icon").style.display="none";moreInfo.userComentFlag=1}}};function scaleImage(e){var a=window.deviceWidth-20,d=picConHeight,b=window.mobileType=="iphone"?0:10,c=new Image();c.onload=function(){if(this.width>0&&this.height>0){if(this.width/this.height>=a/d){if(this.width>a){e.width=a;e.height=(this.height*a)/this.width}else{e.width=this.width;e.height=this.height}}else{if(this.height>d){e.height=d;e.width=(this.width*d)/this.height}else{e.width=this.width;e.height=this.height}}e.style.marginTop=((window.picConHeight-e.height)/2-b)+"px";e.style.display="none";e.style.display="block";e.setAttribute("_src","")}};c.src=e.src}function setBodyHeight(){window.deviceWidth=document.documentElement.clientWidth;window.deviceHeight=document.documentElement.clientHeight};
window.templateType="sale";function resetPageContent(){if(T.g("container")){T.g("container").style.display="none"}if(T.g("mask")){T.g("mask").style.display="none"}if(T.g("box_content")){T.g("box_content").style.display="none"}}function fillData(c,b){var b=b||{},a=b.type||{};if(!c){return}if(c.detail_info&&c.detail_info.premium2&&c.detail_info.premium2.length){saleInfo(c)}setTimeout(function(){addStat(STAT_INDEX_SALE_SHOW);addStat(1,{stat_type:"lbc_promo",promo_id:saleInfo.sale_id_all,action:1})},1000);callAppFun("relayout")}function saleInfo(l){var x=l.detail_info&&l.detail_info.premium2,c=[],s=0,h=[];if(!(x&&x.length)){return}for(var q=0;q<x.length;q++){var t=x[q],r=t.discount_id,v="width=326&",f="height=234&",j="aligh=left,center,right",b="quality=90&",e="http://map.baidu.com/maps/services/thumbnails?"+v+f+j+b+"src=",g=t.discount_dl||0,u=t.discount_lf||0,y=t.discount_title&&t.discount_title.replace(/&lt;[\w\\/]*&gt;/ig,"")||"",n=t.cn_name||(t.discount_src&&t.discount_src.cn_name),w=t.discount_src&&t.discount_src.en_name||"",o=t.discount_content.replace(/^(\r\n)*/g,"").replace(/\r\n/g,"<br>"),a="",p=t.discount_photo,m="";h.push(r);if(p.split(";")[0]){p=p.split(";")[0]}if(!(t&&y)){continue}if(t.discount_offline&&t.discount_offline==1){a=" sale_button_2";m=" offline = 1"}c.push('<div style="position:relative;float:left;width:'+(document.body.clientWidth*0.87)+"px;margin-right:"+(document.body.clientWidth*0.04)+'px">');c.push('<div class="sale_num">'+(q+1)+"/"+x.length+"</div>");c.push('<div class="new_sale_list">');c.push('    <ul class="list shop min_hei_1" id="richInfo">');var k=y.length>22?y.slice(0,22)+"...":y;c.push('        <li class="h3 title">'+k+"</li>");c.push('        <li class="img_con">');c.push('            <div class="imgCon"><span src="" style="background-image:url(\''+e+p+'\')" class="sale_pic" ></span>');c.push('                <span style="display:block;height:25px;">');if(g){c.push('                <color class="font_color_1">'+g+"</color>人下载")}if(g&&u){c.push("| ")}if(u){c.push('                剩余<color class="font_color_1">'+u+"</color>张")}c.push('                </span><span class="sale_pic_bottom"></span></div>');c.push('        <div class="valid">有效期:'+t.discount_effective_start+"至"+t.discount_effective_end+"</div></li>");c.push('        <li class="splitLine splitLine1"></li>');c.push('        <li class="h3">优惠详情</li>');c.push("        <li>"+o+"</li>");c.push("    </ul>");c.push('<div class="sale_button_1'+a+'" id="sale_msm_btn'+q+'" '+m+' sale_id="'+r+'" en_name = "'+w+'">');c.push("    发送到手机");c.push("</div>");if(window.poiInfo.place_type&&window.poiInfo.place_type=="sale"){c.push('<div class="container box_1 salebtnCss">');c.push('    <ul class="list sale_icon goto_icon">');c.push('        <li class="color_1">');c.push("    	    <a ontouchstart=\"callAppFun('poidetail')\">查看商户详情</a>");c.push("        </li>");c.push("    </ul>");c.push("</div>")}if((window.poiInfo.place_type&&window.poiInfo.place_type=="sale")||(n&&w&&w!="lbc-claim")){c.push('<div class="splitLine"></div>')}if(n&&w&&w!="lbc-claim"){c.push('<ul class="list from_list">');c.push('    <li class="h3">优惠来源</li>');c.push('    <li class="from_icon_con"><img src="http://map.baidu.com/fwmap/upload/place/icon/'+w+'/50.png" class="from_icon" />'+n+"</li>");c.push("</ul>")}c.push("</div>");c.push('<div class="sale_right_pic"></div>');c.push("</div>");s++}saleInfo.sale_id_all=h.join("|");if(s){saleInfo.data_num=s;T.g("scroller").style.width=(document.body.clientWidth*s*0.91)+"px";T.g("scroller").style.paddingLeft=document.body.clientWidth*0.07+"px";T.g("container").style.display="";T.g("thelist").innerHTML=c.join("");document.body.style.height=T.g("wrapper").clientHeight+"px";bindEvent()}window.myScroll=new iScroll("wrapper",{snap:true,momentum:false,hScrollbar:false,scrollScale:0.91,scrollPart:false,onBeforeScrollStart:null})}function bindEvent(){var a=saleInfo.data_num;for(var b=0;b<a;b++){if(!T.g("sale_msm_btn"+b)){continue}(function(){var c=T.g("sale_msm_btn"+b);if(c.getAttribute("offline")!=1){T.on(c,"touchstart",openSendSmsBox);T.on(c,"touchstart",function(d){T.addClass(c,"box_1_hover")});T.on(c,"touchend",function(){T.removeClass(c,"box_1_hover")});T.on(c,"touchcancel",function(){T.removeClass(c,"box_1_hover")})}})()}}function testLength(){var b=T.g("sale_tel_inpu"),a=b.className;if(!b.value.length){T.removeClass(b,"inputTipNull")}else{if(a.indexOf("inputTipNull")<0){T.addClass(b,"inputTipNull")}}}function openSendSmsBox(){var d=this.getAttribute("sale_id"),c=this.getAttribute("en_name"),e=T.g("send_message"),g=T.g("send_box"),f=T.g("sale_tel_inpu"),b=T.g("box_tel_message"),a=Storage.getItem("placeSalTelNum");openSendSmsBox.sale_id=d;openSendSmsBox.en_name=c;f.value=a;g.style.display="";e.style.display="none";b.style.display="none";T.g("mask").style.height=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight)+"px";T.g("mask").style.display="";T.g("box_content").style.display="";f.focus();addStat(STAT_INDEX_SALE_BUTTON_CLICK);if(window.poiInfo.from&&window.poiInfo.from=="push"&&window.poiInfo.place_type&&window.poiInfo.place_type=="sale"){addStat(1,{stat_type:"lbc_sale",m:10,sale_id:openSendSmsBox.sale_id})}}function hidenSmsBox(){T.g("mask").style.display="none";T.g("box_content").style.display="none"}function submit_sms(){var g=window.poiInfo,h=T.g("sale_tel_inpu"),e=h.value,b=T.g("box_tel_message"),a=openSendSmsBox.sale_id,d=openSendSmsBox.en_name,c=g.uid,f=g.xda_did||"";if(isNaN(e)||e.length!=11){b.style.display="";setTimeout(function(){b.style.display="none";h.focus()},1000);return}Storage.setItem("placeSalTelNum",e);getNetworkStatus(function(i){if(i.networkStatus==0){showMessage({type:"noNetWork"});setTimeout(function(){cancel_sms()},2000)}else{var j=config.dataUrl+"/detail?qt=sms&en_name="+d+"&os=map_"+window.mobileType+"_app&poi_id="+c+"&callback=setsendstatus&mobile="+e+"&promo_id="+a+"&src=map&terminal="+window.mobileType+"&imei="+f+"&t="+Date.now();scriptRequest(j,"sendSaleInfo");showMessage({type:"sendIng"})}})}function setsendstatus(a){var a=a||{};if(a.errorNo==0){showMessage({type:"success"});addStat(STAT_INDEX_SALE_SMS_OK);if(window.poiInfo.from&&window.poiInfo.from=="push"&&window.poiInfo.place_type&&window.poiInfo.place_type=="sale"){addStat(1,{stat_type:"lbc_sale",m:20,sale_id:openSendSmsBox.sale_id})}addStat(1,{stat_type:"lbc_promo",promo_id:openSendSmsBox.sale_id,action:2})}else{showMessage({message:a.errMsg});addStat(STAT_INDEX_SALE_SMS_FAIL)}setTimeout(function(){cancel_sms()},2000)}function showMessage(c){var c=c||{},a={noNetWork:"请检查网络，稍后重试",sendIng:"正在发送...",success:"发送成功",fail:"发送失败"},b=c.message||a[c.type]||a.fail,d=T.g("send_message"),e=T.g("send_box");e.style.display="none";d.style.display="";d.innerHTML=b}function cancel_sms(){hidenSmsBox()};